<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Forecast</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 480px; margin: auto; padding: 20px; }
    .weather-card { border: 1px solid #ccc; border-radius: 8px; padding: 12px; margin-top: 10px; }
    .forecast { margin-top: 20px; }
    .lang-switch { margin-bottom: 10px; }
    button { padding: 8px 12px; margin-right: 5px; }
    input { width: 100%; padding: 8px; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="lang-switch">
    <button id="enBtn">English</button>
    <button id="zhBtn">中文</button>
  </div>

  <h2 id="title">Weather Forecast</h2>

  <div>
    <input type="text" id="cityInput" placeholder="Enter city or country" />
    <button id="searchBtn">Search</button>
  </div>

  <div id="result"></div>

  <script>
    const apiKey = '143454aa39bbe3442a890cdbf3f9db36'; // 你的 forecast API key
    let lang = 'en';

    document.getElementById('enBtn').onclick = () => { lang='en'; updateTexts(); };
    document.getElementById('zhBtn').onclick = () => { lang='zh'; updateTexts(); };

    function updateTexts(){
      if(lang==='en'){
        document.getElementById('title').innerText='Weather Forecast';
        document.getElementById('cityInput').placeholder='Enter city or country';
        document.getElementById('searchBtn').innerText='Search';
      } else {
        document.getElementById('title').innerText='天气预报';
        document.getElementById('cityInput').placeholder='输入城市或国家';
        document.getElementById('searchBtn').innerText='查询天气';
      }
    }

    updateTexts();

    document.getElementById('searchBtn').onclick = async () => {
      const city = document.getElementById('cityInput').value.trim();
      if(!city) return;

      const url = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&units=metric&appid=${apiKey}&lang=${lang}`;
      
      try {
        const res = await fetch(url);
        if(!res.ok){
          document.getElementById('result').innerHTML = `<p>${lang==='en'?'City not found':'未找到城市'}</p>`;
          return;
        }
        const data = await res.json();

        // 当前天气：取 list[0]
        const now = data.list[0];
        const nowDt = new Date(now.dt * 1000);
        let html = `
          <div class="weather-card">
            <h3>${lang==='en'?'Current Weather':'当前天气'} — ${data.city.name}</h3>
            <p>${lang==='en'?'Temperature':'温度'}: ${now.main.temp}°C</p>
            <p>${lang==='en'?'Humidity':'湿度'}: ${now.main.humidity}%</p>
            <p>${lang==='en'?'Wind Speed':'风速'}: ${now.wind.speed} m/s</p>
            <p>${lang==='en'?'Time':'时间'}: ${nowDt.toLocaleString()}</p>
            <p>${lang==='en'?'Sunrise/Sunset':'日出/日落'}: N/A</p>
          </div>
        `;

        // 3-Day Forecast
        html += `<div class="forecast"><h4>${lang==='en'?'3-Day Forecast':'三天预报'}</h4>`;

        const forecastDays = {};
        data.list.forEach(item=>{
          const d = new Date(item.dt*1000);
          const key = d.getUTCDate();
          if(Object.keys(forecastDays).length < 3){
            // 挑选每天中午 12 点的预测，或者最接近的
            if(!forecastDays[key] && d.getUTCHours()===12){
              forecastDays[key]=item;
            }
          }
        });

        Object.values(forecastDays).forEach(item=>{
          const d = new Date(item.dt*1000);
          html += `
            <div class="weather-card">
              <p>${d.toLocaleDateString()} — ${lang==='en'?'Temp':'温度'}: ${item.main.temp}°C, ${item.weather[0].description}</p>
            </div>
          `;
        });

        html += `</div>`;
        document.getElementById('result').innerHTML = html;

      } catch(err){
        document.getElementById('result').innerHTML = `<p>${lang==='en'?'Error fetching data':'获取数据出错'}</p>`;
      }
    }
  </script>
</body>
</html>
